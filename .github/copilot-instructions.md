# Copilot Instructions

- Purpose: Lua automation for the VLBS game client; scripts drive menu clicks, inventory filtering, and item claiming inside the injected runtime that exposes `system`, `player`, `item`, `menu`, `dialog`, `npc`, `shop`, `box`, `map`, `timer`, `echo`, etc.
- Core libs: Use [Scripts/LIB/VulanLib.lua](Scripts/LIB/VulanLib.lua) for low-level helpers (chat, menu waiting, NPC and movement helpers, item counting/moving). Build higher-level flows on [Scripts/LIB/chung.lua](Scripts/LIB/chung.lua), which sets globals (`gl_*`), filtering, chest handling, menu helpers, and reporting. [Scripts/LIB/MrCoLib.lua](Scripts/LIB/MrCoLib.lua) bootstraps both, loads config, overrides `UseItemName` to search only inventory, and exposes item-claim helpers (`NhanDoXanh*`, `NhanHKMP*`, `NhanDoHoangKim`), plus `ThemSetDo` to register filter sets.
- Configuration: Tune defaults in [Scripts/00_config.lua](Scripts/00_config.lua) ? e.g., `gl_LocDoTheoSet` (1=use set lists vs. `tbThuocTinh` thresholds), `gl_SoDongVip`, `gl_LocDoNguHanh`, `gl_menuClickSpeed`, `gl_GuiDo`, `gl_Debug`, `gl_QuangCao/ChatNham`, `gl_SoluongItem`, and base `tbThuocTinh` thresholds.
- Set definitions: Desired attribute combos live in [Scripts/LIB/setdo](Scripts/LIB/setdo) (`hoa-*`, `thuy-*`, `moc-*`, `tho-*`, `kim-*`, `vk.lua`). Each file calls `ThemSetDo({...})` with `magicType -> minValue`. The active scripts (e.g., [Scripts/Loc Do Xanh dai lung.lua](Scripts/Loc%20Do%20Xanh%20dai%20lung.lua), [Scripts/Loc Do Xanh vu khi.lua](Scripts/Loc%20Do%20Xanh%20vu%20khi.lua)) add their own sets before looping `NhanDoXanh`.
- Filtering pipeline: `LocDo`/`LocDoXongBan` in [Scripts/LIB/chung.lua](Scripts/LIB/chung.lua) scan inventory (`item.GetKey==0`). When `gl_LocDoTheoSet==1`, an item is VIP if it satisfies every entry of any `tbSetDo` set; otherwise it uses `tbThuocTinh` and keeps items when the count of matched attrs is below `gl_SoDongVip`. Optional five-element filtering (`gl_LocDoNguHanh`) cross-checks `tbNguHanh` slots. Non-VIP items are immediately sold via `ShopItem`; VIP items can be auto-stashed to chest via `GuiDo` when `gl_GuiDo`.
- Chest logic: `GuiDo` opens chests (default + two expansions) and drops held items using `player.FindRoom`. If chests are full or inaccessible it disables `gl_GuiDo` to avoid loops. Any held item is thrown away before chest operations (`quangItemRaNgoai`).
- Reporting: Filtering stats are periodically logged and written per day/player to [Scripts/reportFilter](Scripts/reportFilter) via `reportFilter`; message spam is gated by `gl_ChatNham` and `gl_QuangCao` timers.
- Map-specific automation: [Scripts/ban_do.lua](Scripts/ban_do.lua) maintains `TB_Map`/`TB_Map_Set` and calls `LocDoXongBan` three times when entering listed maps, then idles (5s) while inside; outside maps it resets state and polls faster.
- Item claiming flows: `NhanDoXanhCap1/Cap10`, `NhanHKMP`, `NhanAnBangDinhQuoc`, `NhanDoHoangKim`, etc., in [Scripts/LIB/MrCoLib.lua](Scripts/LIB/MrCoLib.lua) orchestrate menu clicks (`clickMenuAll`, `nhapso`) after `LocDo` and free-space checks (`freeCellCatch`). Long-running scripts define a `main()` that loops these helpers; comments above `NhanDoXanh()` calls document the menu path indices expected by the game.
- Helpers/conventions: Use `clickMenu*`, `hasDialogOrMenu`, `getFreeHanhTrang`, `tbVulanLib.UseItemName/MoveItem` instead of reimplementing UI polling. Respect `gl_InternetDelay`/`gl_InternetDelayCatch` adjustments set by `ShopItem` to throttle interactions. Keep globals ASCII; many strings contain extended characters?retain them as-is when editing.
- Adding a new filter or script: (1) declare thresholds in a new `setdo/*.lua` or inline `ThemSetDo`, (2) ensure `gl_LocDoTheoSet=1` or update `tbThuocTinh` when using baseline mode, (3) wire a `main()` that calls `Nhan*`/`LocDo*` with the correct menu indices, and (4) verify chest space if `gl_GuiDo` is enabled.
- Files to read first when orienting: [Scripts/LIB/chung.lua](Scripts/LIB/chung.lua) (filtering + chest), [Scripts/LIB/MrCoLib.lua](Scripts/LIB/MrCoLib.lua) (bootstrap + claim flows), [Scripts/00_config.lua](Scripts/00_config.lua) (runtime toggles), and relevant set definitions under [Scripts/LIB/setdo](Scripts/LIB/setdo).

Need clarification or more patterns documented? Tell me which workflows feel unclear and I?ll refine this file.
